{
  "k":"Apache",
  "t":"macOS 上安裝 Apache",
  "i":"2020-03-17",
  "a":[
    {
      "e":"h2",
      "t":"Youtube 影音教學版"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"a",
              "attr":{
                "href":"https://www.youtube.com/watch?v=V32zn8xtGnM",
                "target":"_blank"
              },
              "t":"https://www.youtube.com/watch?v=V32zn8xtGnM"
            }
          ]
        }
      ]
    },
    {
      "e":"h2",
      "t":"安裝步驟"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"更新 xcode command line，終端機下 "
            },
            {
              "e":"code",
              "t":"xcode-select --install"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"更新 Brew "
            },
            {
              "e":"code",
              "t":"brew update"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"移除停止使用 mac 原生的 Apache"
            },
            {
              "e":"ul",
              "s":[
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"先暫停 Apache "
                    },
                    {
                      "e":"code",
                      "t":"sudo apachectl stop"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"自動開啟先關閉 "
                    },
                    {
                      "e":"code",
                      "t":"sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist 2&gt;/dev/null"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"安裝新的 Apache"
            },
            {
              "e":"ul",
              "s":[
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"用 Brew 安裝 "
                    },
                    {
                      "e":"code",
                      "t":"brew install httpd"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"啟動 Apache "
                    },
                    {
                      "e":"code",
                      "t":"sudo brew services start httpd"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"設定 "
                    },
                    {
                      "e":"code",
                      "t":"ps -aef | grep httpd"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"重開 "
                    },
                    {
                      "e":"code",
                      "t":"sudo apachectl -k restart"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"新 Apache 指令"
            },
            {
              "e":"ul",
              "s":[
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"開啟 "
                    },
                    {
                      "e":"code",
                      "t":"sudo apachectl start"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"關閉 "
                    },
                    {
                      "e":"code",
                      "t":"sudo apachectl stop"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"重開 "
                    },
                    {
                      "e":"code",
                      "t":"sudo apachectl -k restart"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"新 Apache 相關設定"
            },
            {
              "e":"ul",
              "s":[
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"用 Sublime Text 打開編輯 "
                    },
                    {
                      "e":"code",
                      "t":"/usr/local/etc/httpd/httpd.conf"
                    },
                    {
                      "e":"span",
                      "t":"，終端機執行指令 "
                    },
                    {
                      "e":"code",
                      "t":"subl /usr/local/etc/httpd/httpd.conf"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"修改 "
                    },
                    {
                      "e":"code",
                      "t":"Listen 8080"
                    },
                    {
                      "e":"span",
                      "t":" 改為 "
                    },
                    {
                      "e":"code",
                      "t":"Listen 80"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"修改 "
                    },
                    {
                      "e":"code",
                      "t":"DocumentRoot \"/usr/local/var/www\""
                    },
                    {
                      "e":"span",
                      "t":"，改成指定位置 "
                    },
                    {
                      "e":"code",
                      "t":"DocumentRoot \"/Users/oa/www\""
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"修改 "
                    },
                    {
                      "e":"code",
                      "t":"&lt;Directory \"/usr/local/var/www\"&gt;"
                    },
                    {
                      "e":"span",
                      "t":"，改成指定位置 "
                    },
                    {
                      "e":"code",
                      "t":"&lt;Directory \"/Users/oa/www\"&gt;"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"拿掉註解 "
                    },
                    {
                      "e":"code",
                      "t":"LoadModule rewrite_module lib/httpd/modules/mod_rewrite.so"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"拿掉註解，並改成 "
                    },
                    {
                      "e":"code",
                      "t":"ServerName localhost"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"拿掉註解 "
                    },
                    {
                      "e":"code",
                      "t":"Include /usr/local/etc/httpd/extra/httpd-vhosts.conf"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"為了之後方便常常設定，不用每次輸入密碼，開啟終端機，輸入指令 "
                    },
                    {
                      "e":"code",
                      "t":"sudo chmod 777 /usr/local/etc/httpd/httpd.conf"
                    },
                    {
                      "e":"span",
                      "t":" 將權限打開"
                    }
                  ]
                },
                {
                  "e":"li",
                  "s":[
                    {
                      "e":"span",
                      "t":"為了之後方便常常設定，所以建立一個鏈結，開啟終端機，輸入指令 "
                    },
                    {
                      "e":"code",
                      "t":"ln -s /usr/local/etc/httpd/httpd.conf ~/Documents/httpd.conf"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"重開 Apache "
            },
            {
              "e":"code",
              "t":"sudo apachectl -k restart"
            }
          ]
        }
      ]
    },
    {
      "e":"h2",
      "t":"設定 Host"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"位置在 "
            },
            {
              "e":"code",
              "t":"/etc/hosts"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"為了之後方便常常設定，不用每次輸入密碼，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"sudo chmod 777 /etc/hosts"
            },
            {
              "e":"span",
              "t":" 將權限打開"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"為了之後方便常常設定，所以建立一個鏈結，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"ln -s /etc/hosts ~/Documents/hosts"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"用 Sublime Text 打開編輯 "
            },
            {
              "e":"code",
              "t":"/etc/hosts"
            },
            {
              "e":"span",
              "t":"，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"subl /etc/hosts"
            },
            {
              "e":"span",
              "t":"，將內容調整一下，常用內容如下："
            }
          ]
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"127.0.0.1 dev.case.ioa.tw"
        }
      ]
    },
    {
      "e":"h2",
      "t":"設定 Virtual Host"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"位置在 "
            },
            {
              "e":"code",
              "t":"/usr/local/etc/httpd/extra/httpd-vhosts.conf"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"為了之後方便常常設定，不用每次輸入密碼，開啟終端機，輸入指令 "
            },
            {
              "e":"code",
              "t":"sudo chmod 777 /usr/local/etc/httpd/extra/httpd-vhosts.conf"
            },
            {
              "e":"span",
              "t":" 將權限打開"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"為了之後方便常常設定，所以建立一個鏈結，開啟終端機，輸入指令 "
            },
            {
              "e":"code",
              "t":"ln -s /usr/local/etc/httpd/extra/httpd-vhosts.conf ~/Documents/httpd-vhosts.conf"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"用 Sublime Text 打開編輯 "
            },
            {
              "e":"code",
              "t":"/usr/local/etc/httpd/extra/httpd-vhosts.conf"
            },
            {
              "e":"span",
              "t":"，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"subl /usr/local/etc/httpd/extra/httpd-vhosts.conf"
            },
            {
              "e":"span",
              "t":"，將內容調整一下，常用內容如下："
            }
          ]
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"# root\n&lt;VirtualHost *:80&gt;\n  ServerAdmin comdan66@gmail.com\n  DocumentRoot \"/Users/oa/www\"\n\n  &lt;Directory \"/Users/oa/www\"&gt;\n      Options FollowSymLinks MultiViews\n      AllowOverride All\n      Order allow,deny\n      Allow from all\n  &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n\n# Case\n&lt;VirtualHost *:80&gt;\n  ServerName dev.case.ioa.tw\n  ServerAlias dev.case.ioa.tw\n\n  DocumentRoot \"/Users/oa/www/case\"\n  &lt;Directory \"/Users/oa/www/case\"&gt;\n      Options FollowSymLinks MultiViews\n      AllowOverride All\n      Order allow,deny\n      Allow from all\n  &lt;/Directory&gt;\n&lt;/VirtualHost&gt;"
        }
      ]
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"設定好後，記得重開 Apache，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"sudo apachectl -k restart"
            }
          ]
        }
      ]
    },
    {
      "e":"blockquote",
      "s":[
        {
          "e":"p",
          "s":[
            {
              "e":"span",
              "t":"請注意路徑，此 "
            },
            {
              "e":"code",
              "t":"vhosts.conf"
            },
            {
              "e":"span",
              "t":" 的 "
            },
            {
              "e":"code",
              "t":"DocumentRoot"
            },
            {
              "e":"span",
              "t":" 與 "
            },
            {
              "e":"code",
              "t":"Directory"
            },
            {
              "e":"span",
              "t":" 路徑為 OA 本人的，請注意自己的路徑是否正確。"
            }
          ]
        }
      ]
    },
    {
      "e":"h2",
      "t":"設定 https 的 ssl 功能"
    },
    {
      "e":"p",
      "t":"此功能一般來說不太會用到，所以不一定要安裝，不需要的話直接跳過即可！"
    },
    {
      "e":"p",
      "t":"因為通常都是本機開發，所以就藉由 openssl 來做本機開發吧！"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"編輯 Conf，指令輸入 "
            },
            {
              "e":"code",
              "t":"subl /usr/local/etc/httpd/httpd.conf"
            }
          ]
        },
        {
          "e":"li",
          "t":"將以下三個註解拿掉"
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"LoadModule socache_shmcb_module lib/httpd/modules/mod_socache_shmcb.so"
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"LoadModule ssl_module lib/httpd/modules/mod_ssl.so"
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"Include /usr/local/etc/httpd/extra/httpd-ssl.conf"
        }
      ]
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"編輯 SSL Conf，指令輸入 "
            },
            {
              "e":"code",
              "t":"subl /usr/local/etc/httpd/extra/httpd-ssl.conf"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"將 "
            },
            {
              "e":"code",
              "t":"Listen 8443"
            },
            {
              "e":"span",
              "t":" 改為 "
            },
            {
              "e":"code",
              "t":"Listen 443"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"將 "
            },
            {
              "e":"code",
              "t":"&lt;VirtualHost _default_:8443&gt;"
            },
            {
              "e":"span",
              "t":" 改為 "
            },
            {
              "e":"code",
              "t":"&lt;VirtualHost _default_:443&gt;"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"將 "
            },
            {
              "e":"code",
              "t":"DocumentRoot"
            },
            {
              "e":"span",
              "t":" 與 "
            },
            {
              "e":"code",
              "t":"ServerName"
            },
            {
              "e":"span",
              "t":" 註解"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"編輯 vhost，指令輸入 "
            },
            {
              "e":"code",
              "t":"subl /usr/local/etc/httpd/extra/httpd-vhosts.conf"
            }
          ]
        },
        {
          "e":"li",
          "t":"新增以下"
        }
      ]
    },
    {
      "e":"pre",
      "s":[
        {
          "e":"code",
          "t":"&lt;VirtualHost *:443&gt;\n    DocumentRoot \"/Users/oa/www\"\n    ServerName localhost\n    SSLEngine on\n    SSLCertificateFile \"/usr/local/etc/httpd/server.crt\"\n    SSLCertificateKeyFile \"/usr/local/etc/httpd/server.key\"\n&lt;/VirtualHost&gt;"
        }
      ]
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "t":"第一次設定，需要產生 key，所以要執行 openssl"
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"終端機進入目錄，指令 "
            },
            {
              "e":"code",
              "t":"cd /usr/local/etc/httpd"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"產生 ssl key，指令 "
            },
            {
              "e":"code",
              "t":"openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server.key -out server.crt"
            },
            {
              "e":"span",
              "t":"，中間要你輸入資料，因為是本機開發，所以簡單輸入即可"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"執行 "
            },
            {
              "e":"code",
              "t":"sudo apachectl configtest"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"重新啟動 "
            },
            {
              "e":"code",
              "t":"sudo apachectl -k restart"
            }
          ]
        }
      ]
    },
    {
      "e":"h2",
      "t":"重點整理"
    },
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"Conf 位置 "
            },
            {
              "e":"code",
              "t":"/usr/local/etc/httpd/httpd.conf"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"Vhosts 位置 "
            },
            {
              "e":"code",
              "t":"/usr/local/etc/httpd/extra/httpd-vhosts.conf"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"開啟 Apache，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"sudo apachectl start"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"關閉 Apache，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"sudo apachectl stop"
            }
          ]
        },
        {
          "e":"li",
          "s":[
            {
              "e":"span",
              "t":"重開 Apache，終端機執行指令 "
            },
            {
              "e":"code",
              "t":"sudo apachectl -k restart"
            }
          ]
        }
      ]
    }
  ],
  "r":[
    {
      "e":"ul",
      "s":[
        {
          "e":"li",
          "s":[
            {
              "e":"a",
              "attr":{
                "href":"https://getgrav.org/blog/macos-mojave-apache-ssl",
                "target":"_blank"
              },
              "t":"https://getgrav.org/blog/macos-mojave-apache-ssl"
            }
          ]
        }
      ]
    }
  ],
  "g":[
    "Apache",
    "後端",
    "http"
  ]
}